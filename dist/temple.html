<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>üèÉ Temple Run!</title><link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;800&family=Nunito:wght@700;900&display=swap" rel="stylesheet"><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Baloo 2',cursive;background:#0a0a1a;overflow:hidden;height:100vh;width:100vw;user-select:none}#canvas{position:fixed;inset:0;width:100%;height:100%}#hud{position:fixed;top:0;left:0;right:0;display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:linear-gradient(180deg,rgba(10,10,26,.9) 0,transparent 100%);z-index:10;pointer-events:none}.hud-left{display:flex;align-items:center;gap:8px}.hud-left span{font-size:clamp(13px,2vw,18px);color:rgba(255,255,255,.7);font-weight:700;font-family:Nunito,sans-serif;text-transform:uppercase;letter-spacing:1px}.dist-val{font-size:clamp(26px,5vw,44px)!important;font-weight:800!important;color:#ffd93d!important;text-shadow:0 0 18px rgba(255,217,61,.8);letter-spacing:-1px!important;font-family:'Baloo 2',cursive!important}.speed-badge{background:linear-gradient(135deg,#ff4500,#ff8c00);color:#fff;padding:5px 16px;border-radius:28px;font-size:clamp(12px,1.8vw,15px);font-weight:800;box-shadow:0 4px 14px rgba(255,69,0,.5)}#countdown{display:none;position:fixed;inset:0;background:rgba(10,10,26,.75);flex-direction:column;align-items:center;justify-content:center;z-index:25;backdrop-filter:blur(4px)}#countdown.show{display:flex}#countNum{font-size:clamp(100px,20vw,180px);font-weight:800;color:#fff;line-height:1;animation:countPop .5s cubic-bezier(.34,1.56,.64,1);text-shadow:0 0 60px rgba(255,100,0,.9)}@keyframes countPop{from{transform:scale(2);opacity:0}to{transform:scale(1);opacity:1}}#countdown p{font-family:Nunito,sans-serif;font-size:clamp(14px,2.5vw,22px);color:rgba(255,255,255,.7);font-weight:700;margin-top:10px;text-align:center;padding:0 20px}#loading{position:fixed;inset:0;background:rgba(10,10,26,.97);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px;z-index:20}#loading h2{color:#fff;font-size:clamp(22px,4vw,32px);font-weight:800}#loading p{color:rgba(255,255,255,.6);font-family:Nunito,sans-serif;font-size:clamp(13px,2vw,18px);font-weight:700;text-align:center;padding:0 20px}.spinner{width:56px;height:56px;border:4px solid rgba(255,100,0,.2);border-top-color:#ff4500;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}#hitFlash{position:fixed;inset:0;pointer-events:none;z-index:15;opacity:0;background:rgba(255,50,0,.6)}#hitFlash.flash{animation:flashAnim .65s ease-out}@keyframes flashAnim{0%{opacity:1}100%{opacity:0}}#youreOut{display:none;position:fixed;inset:0;align-items:center;justify-content:center;z-index:28;pointer-events:none}#youreOut.show{display:flex}#youreOut span{font-size:clamp(52px,11vw,110px);font-weight:800;color:#fff;text-align:center;text-shadow:0 0 50px rgba(255,80,0,.95),0 4px 20px rgba(0,0,0,.6);animation:youreOutAnim 2s ease-out forwards}@keyframes youreOutAnim{0%{opacity:0;transform:scale(.15) rotate(-10deg)}18%{opacity:1;transform:scale(1.18) rotate(3deg)}32%{transform:scale(1) rotate(0)}72%{opacity:1}100%{opacity:0;transform:translateY(-30px) scale(.9)}}#gameover{display:none;position:fixed;inset:0;background:rgba(10,10,26,.92);flex-direction:column;align-items:center;justify-content:center;z-index:30;gap:14px;backdrop-filter:blur(8px)}#gameover.show{display:flex}@keyframes goBounce{0%,100%{transform:translateY(0) rotate(-5deg)}50%{transform:translateY(-18px) rotate(5deg)}}#gameover .go-emoji{font-size:clamp(60px,10vw,90px);animation:goBounce 1.5s ease-in-out infinite}#gameover h2{font-size:clamp(28px,5.5vw,56px);font-weight:800;background:linear-gradient(135deg,#ff8c00,gold);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.go-score-wrap{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.15);border-radius:22px;padding:18px 44px;text-align:center}.go-score-label{color:rgba(255,255,255,.5);font-family:Nunito;font-size:13px;font-weight:700;letter-spacing:2px;text-transform:uppercase}.go-score-num{font-size:clamp(44px,8vw,76px);font-weight:800;color:#ff8c00;text-shadow:0 0 36px rgba(255,140,0,.6);line-height:1}.go-score-msg{color:rgba(255,255,255,.5);font-family:Nunito;font-size:14px;font-weight:700;margin-top:4px}.go-buttons{display:flex;gap:14px;flex-wrap:wrap;justify-content:center;margin-top:6px}.go-btn{padding:14px 36px;border-radius:50px;border:none;font-family:'Baloo 2',cursive;font-size:clamp(15px,2.5vw,19px);font-weight:800;cursor:pointer;transition:transform .2s}.go-btn:hover{transform:scale(1.06)}.go-btn:active{transform:scale(.96)}.go-btn-play{background:linear-gradient(135deg,#ff4500,#ff8c00);color:#fff;box-shadow:0 6px 28px rgba(255,69,0,.5)}.go-btn-home{background:rgba(255,255,255,.1);color:#fff;border:1px solid rgba(255,255,255,.2)}#tipBar{position:fixed;bottom:14px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.55);border:1px solid rgba(255,255,255,.12);border-radius:40px;padding:7px 22px;font-family:Nunito,sans-serif;font-size:clamp(11px,1.8vw,14px);color:rgba(255,255,255,.55);font-weight:700;z-index:10;pointer-events:none;white-space:nowrap}#backBtn{position:fixed;top:12px;right:12px;padding:9px 18px;border-radius:40px;border:1px solid rgba(255,255,255,.2);background:rgba(0,0,0,.4);color:rgba(255,255,255,.6);font-family:'Baloo 2',cursive;font-size:13px;font-weight:700;cursor:pointer;z-index:10;transition:all .2s}#backBtn:hover{background:rgba(0,0,0,.7);color:#fff}#permError{display:none;position:fixed;inset:0;background:rgba(10,10,26,.97);flex-direction:column;align-items:center;justify-content:center;gap:14px;z-index:25;text-align:center;padding:28px}#permError.show{display:flex}#permError .pe-icon{font-size:56px}#permError h2{color:#fff;font-size:clamp(20px,4vw,28px);font-weight:800}#permError p{color:rgba(255,255,255,.6);font-family:Nunito;font-size:clamp(13px,2vw,16px);font-weight:700;max-width:400px;line-height:1.6}#permError button{padding:13px 34px;border-radius:40px;border:none;background:linear-gradient(135deg,#ff4500,#ff8c00);color:#fff;font-family:'Baloo 2';font-size:clamp(15px,2.5vw,18px);font-weight:800;cursor:pointer;margin-top:6px}</style></head><body><canvas id="canvas"></canvas><video id="video" style="display:none" playsinline autoplay muted></video><div id="hud"><div class="hud-left"><span>üèÉ</span> <span class="dist-val" id="distVal">0</span> <span>m</span></div><div><div class="speed-badge" id="speedBadge">Speed 1</div></div></div><button id="backBtn" onclick="goHome()">‚Üê Home</button><div id="hitFlash"></div><div id="youreOut"><span>üí• BOOM!</span></div><div id="countdown"><div id="countNum">3</div><p>üßç Stand back! Lean left/right to dodge<br>üôå Raise both hands to jump!</p></div><div id="loading"><div class="spinner"></div><h2>üèÉ Getting Ready...</h2><p id="loadingMsg">Starting your webcam...</p></div><div id="permError"><div class="pe-icon">üì∑</div><h2>Camera Needed!</h2><p>We need your webcam to track your body. Please allow camera access and try again!</p><button onclick="retryCamera()">Try Again üì∑</button></div><div id="gameover"><div class="go-emoji" id="goEmoji">üî•</div><h2>Burned! üî•</h2><div class="go-score-wrap"><div class="go-score-label">Distance Survived</div><div class="go-score-num" id="finalScore">0</div><div class="go-score-msg" id="finalMsg"></div></div><div class="go-buttons"><button class="go-btn go-btn-play" onclick="restartGame()">üîÑ Run Again!</button> <button class="go-btn go-btn-home" onclick="goHome()">üè† Home</button></div></div><div id="tipBar">üèÉ Lean left/right to dodge &nbsp;‚Ä¢&nbsp; üôå Raise both hands to jump!</div><script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script><script>let GEO={};function computeGeo(){const t=canvas.width,e=canvas.height;GEO.W=t,GEO.H=e,GEO.vpX=.5*t,GEO.vpY=.28*e,GEO.botY=.84*e,GEO.leftX=.06*t,GEO.rightX=.94*t;const a=GEO.rightX-GEO.leftX;GEO.rails=[GEO.leftX,GEO.leftX+a/3,GEO.leftX+2*a/3,GEO.rightX],GEO.laneC=[GEO.leftX+a/6,GEO.leftX+a/2,GEO.leftX+5*a/6],GEO.tw=a}function pX(t,e){return GEO.vpX+(t-GEO.vpX)*e}function pY(t){return GEO.vpY+(GEO.botY-GEO.vpY)*t}function pS(t){return.88*t+.12}function laneCX(t){const e=Math.max(0,Math.min(2,t));return e<=1?GEO.laneC[0]+(GEO.laneC[1]-GEO.laneC[0])*e:GEO.laneC[1]+(GEO.laneC[2]-GEO.laneC[1])*(e-1)}const OBS_POOL=["rock","rock","fireball","rock","fireball","wall"];class Obstacle{constructor(){this.type=OBS_POOL[Math.floor(Math.random()*OBS_POOL.length)],"wall"===this.type?this.openLane=Math.floor(3*Math.random()):this.lane=Math.floor(3*Math.random()),this.z=.04,this.phase=Math.random()*Math.PI*2,this.checked=!1}update(t){return this.z+=t,this.phase+=.1,this.z<1.1}getCollisionLanes(){return"wall"===this.type?[0,1,2].filter(t=>t!==this.openLane):[this.lane]}draw(t){const e=this.z;if(e<.05||e>1.05)return;const a=pS(e),n=pY(e);if("wall"===this.type){[0,1,2].forEach(o=>{if(o===this.openLane)return;const i=pX(GEO.laneC[o],e),s=GEO.tw/3*a*.88,l=72*a,r=Math.min(1,1.8*e);t.save();const c=t.createLinearGradient(i,n-l,i,n);c.addColorStop(0,`rgba(255,90,0,${r})`),c.addColorStop(1,`rgba(180,40,0,${r})`),t.fillStyle=c,t.fillRect(i-s/2,n-l,s,l),t.strokeStyle=`rgba(255,220,0,${.7*r})`,t.lineWidth=3*a,t.setLineDash([9*a,5*a]),t.beginPath(),t.moveTo(i-s/2+5*a,n-.5*l),t.lineTo(i+s/2-5*a,n-.5*l),t.stroke(),t.setLineDash([]),t.restore()});const o=pX(GEO.laneC[this.openLane],e);return t.save(),t.globalAlpha=.85*Math.min(1,2*e),t.font=28*a+"px serif",t.textAlign="center",t.textBaseline="middle",t.fillText("‚úÖ",o,n-18*a),void t.restore()}const o=pX(GEO.laneC[this.lane],e);if("rock"===this.type){const e=30*a;t.save();const i=t.createRadialGradient(o-.3*e,n-.4*e,.1*e,o,n,e);i.addColorStop(0,"#c0b0a0"),i.addColorStop(.5,"#887060"),i.addColorStop(1,"#504540"),t.fillStyle=i,t.beginPath(),t.ellipse(o,n,1.2*e,e,0,0,2*Math.PI),t.fill(),t.strokeStyle="rgba(40,28,20,.5)",t.lineWidth=1.5*a,t.beginPath(),t.moveTo(o-.3*e,n-.2*e),t.lineTo(o,n+.1*e),t.stroke(),t.beginPath(),t.moveTo(o+.2*e,n-.3*e),t.lineTo(o+.5*e,n+.1*e),t.stroke(),t.fillStyle="rgba(0,0,0,.3)",t.beginPath(),t.ellipse(o,n+.25*e,1.1*e,.28*e,0,0,2*Math.PI),t.fill(),t.restore()}if("fireball"===this.type){const i=24*a,s=1+.15*Math.sin(this.phase);t.save();const l=t.createRadialGradient(o,n,0,o,n,2.8*i*s);l.addColorStop(0,`rgba(255,190,0,${.55*Math.min(1,2*e)})`),l.addColorStop(.5,`rgba(255,70,0,${.25*Math.min(1,2*e)})`),l.addColorStop(1,"transparent"),t.fillStyle=l,t.beginPath(),t.arc(o,n,2.8*i*s,0,2*Math.PI),t.fill();const r=t.createRadialGradient(o,n-.2*i,0,o,n,i*s);r.addColorStop(0,"#fffac0"),r.addColorStop(.3,"#ffcc00"),r.addColorStop(.65,"#ff5500"),r.addColorStop(1,"#aa2200"),t.fillStyle=r,t.beginPath(),t.arc(o,n,i*s,0,2*Math.PI),t.fill();for(let e=0;e<5;e++){const a=e/5*Math.PI*2+this.phase,s=o+Math.cos(a)*i*1.3,l=n+Math.sin(a)*i*.7-.4*i;t.fillStyle="rgba(255,110,0,.6)",t.beginPath(),t.ellipse(s,l,.22*i,.38*i,a,0,2*Math.PI),t.fill()}t.restore()}}}class LavaParticle{constructor(t){this.side=t,this._reset()}_reset(){const t=GEO.leftX||.06*window.innerWidth;"L"===this.side?this.x=Math.random()*t*2.5:this.x=(GEO.W||window.innerWidth)-Math.random()*t*2.5,this.y=(GEO.botY||.84*window.innerHeight)+Math.random()*(GEO.H||window.innerHeight)*.18,this.vy=-(2.5+5.5*Math.random()),this.vx=2.2*(Math.random()-.5),this.alpha=.75+.25*Math.random(),this.size=4+10*Math.random();const e=Math.random();this.color=e<.35?"#ff2200":e<.68?"#ff7700":"#ffcc00"}update(){this.x+=this.vx,this.y+=this.vy,this.vy-=.04,this.alpha-=.02,this.size*=.985,(this.alpha<=0||this.y<GEO.vpY)&&this._reset()}draw(t){this.alpha<=0||(t.save(),t.globalAlpha=this.alpha,t.beginPath(),t.arc(this.x,this.y,this.size,0,2*Math.PI),t.fillStyle=this.color,t.fill(),t.restore())}}class BlastParticle{constructor(t,e){this.x=t,this.y=e,this.vx=22*(Math.random()-.5),this.vy=22*(Math.random()-.5)-4;const a=["#ff4500","#ff8c00","#FFD93D","#ff6b9d","#ffffff"];this.color=a[Math.floor(Math.random()*a.length)],this.size=4+14*Math.random(),this.alpha=1,this.isEmoji=Math.random()<.3,this.emoji=["üí•","üî•","‚≠ê","‚ú®"][Math.floor(4*Math.random())],this.rot=Math.random()*Math.PI*2,this.rotV=.3*(Math.random()-.5)}update(){this.x+=this.vx,this.y+=this.vy,this.vy+=.35,this.alpha-=.022,this.rot+=this.rotV,this.vx*=.97}draw(t){this.alpha<=0||(t.save(),t.globalAlpha=Math.max(0,this.alpha),t.translate(this.x,this.y),t.rotate(this.rot),this.isEmoji?(t.font=3*this.size+"px serif",t.textAlign="center",t.textBaseline="middle",t.fillText(this.emoji,0,0)):(t.beginPath(),t.arc(0,0,this.size,0,2*Math.PI),t.fillStyle=this.color,t.fill()),t.restore())}}let obstacles=[],lavaParticles=[],blastParticles=[],poseKeypoints=[],targetLane=1,laneSmooth=1,isJumping=!1,jumpOffset=0,jumpVy=0,lastJumpTime=0,gameActive=!1,hitOccurred=!1,distance=0,gameTimer=0,scrollOffset=0,lastObstacleFrame=0,animFrame=null,pose=null,mpCamera=null;const video=document.getElementById("video"),canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");function onPoseResults(t){if(!gameActive||hitOccurred)return;if(!t.poseLandmarks)return void(poseKeypoints=[]);const e=canvas.width,a=canvas.height;poseKeypoints=t.poseLandmarks.map(t=>({x:(1-t.x)*e,y:t.y*a,xn:1-t.x,yn:t.y,v:t.visibility||0})),updatePlayerInput()}function updatePlayerInput(){const t=poseKeypoints;if(t.length<29)return;const e=t[23],a=t[24],n=(t[11],t[12],t[15]),o=t[16],i=t[0];if(e.v>.3&&a.v>.3){const t=(e.xn+a.xn)/2;targetLane=t<.37?0:t>.63?2:1}if(!isJumping&&n.v>.4&&o.v>.4&&i.v>.4&&n.yn<i.yn-.12&&o.yn<i.yn-.12){const t=Date.now();t-lastJumpTime>1500&&(lastJumpTime=t,isJumping=!0,jumpOffset=0,jumpVy=.018*-canvas.height)}}function drawTrack(){const{W:t,H:e,vpX:a,vpY:n,botY:o,leftX:i,rightX:s,rails:l}=GEO,r=ctx.createLinearGradient(0,n,0,e);r.addColorStop(0,"rgba(120,20,0,.4)"),r.addColorStop(.5,"rgba(210,55,0,.75)"),r.addColorStop(1,"rgba(255,90,0,.95)"),ctx.fillStyle=r,ctx.beginPath(),ctx.moveTo(0,n),ctx.lineTo(a,n),ctx.lineTo(i,o),ctx.lineTo(0,e),ctx.closePath(),ctx.fill();const c=ctx.createLinearGradient(0,n,0,e);c.addColorStop(0,"rgba(120,20,0,.4)"),c.addColorStop(.5,"rgba(210,55,0,.75)"),c.addColorStop(1,"rgba(255,90,0,.95)"),ctx.fillStyle=c,ctx.beginPath(),ctx.moveTo(a,n),ctx.lineTo(t,n),ctx.lineTo(t,e),ctx.lineTo(s,o),ctx.closePath(),ctx.fill();const d=.0015*Date.now(),h=ctx.createRadialGradient(a,n,0,a,n,.45*t);h.addColorStop(0,`rgba(255,110,0,${.28+.07*Math.sin(d)})`),h.addColorStop(1,"transparent"),ctx.fillStyle=h,ctx.fillRect(0,n-.08*e,t,.22*e);const m=ctx.createLinearGradient(a,n,a,o);m.addColorStop(0,"#1e1208"),m.addColorStop(.5,"#2e1a0a"),m.addColorStop(1,"#160c04"),ctx.fillStyle=m,ctx.beginPath(),ctx.moveTo(a,n),ctx.lineTo(s,o),ctx.lineTo(i,o),ctx.closePath(),ctx.fill();for(let t=0;t<=14;t++){let e=(t/14+scrollOffset)%1;if(e<.06)continue;const a=pY(e),n=pX(i,e),o=pX(s,e);ctx.beginPath(),ctx.moveTo(n,a),ctx.lineTo(o,a),ctx.strokeStyle=`rgba(110,75,35,${.5*e})`,ctx.lineWidth=Math.max(.5,1.5*e),ctx.stroke()}for(let t=0;t<4;t++){const e=ctx.createLinearGradient(a,n,l[t],o);e.addColorStop(0,"rgba(150,100,50,.08)"),e.addColorStop(1,"rgba(190,140,70,.85)"),ctx.beginPath(),ctx.moveTo(a,n),ctx.lineTo(l[t],o),ctx.strokeStyle=e,ctx.lineWidth=0===t||3===t?3:1.5,ctx.stroke()}}const AVATAR_IDX=[0,11,12,13,14,15,16,23,24,25,26,27,28],AVATAR_EDGES=[[11,12],[0,11],[0,12],[11,13],[13,15],[12,14],[14,16],[11,23],[12,24],[23,24],[23,25],[25,27],[24,26],[26,28]];function drawAvatar(){const t=poseKeypoints;if(!t.length)return;const e=AVATAR_IDX.filter(e=>e<t.length&&t[e].v>.25);if(e.length<5)return;const a=e.map(e=>t[e].xn),n=e.map(e=>t[e].yn),o=Math.min(...a),i=Math.max(...a),s=Math.min(...n),l=Math.max(...n),r=Math.max(.15,l-s),c=.3*GEO.H,d=Math.min(c/r,.008*GEO.W),h=GEO.botY+jumpOffset,m=laneCX(laneSmooth),f=(o+i)/2,p=t=>m+(t-f)*d,u=t=>h-(l-t)*d,g=GEO.tw/3*.42;ctx.save(),ctx.globalAlpha=Math.max(.05,.28+.001*jumpOffset),ctx.fillStyle="#000",ctx.beginPath(),ctx.ellipse(m,GEO.botY+10,g,.22*g,0,0,2*Math.PI),ctx.fill(),ctx.restore(),ctx.save(),ctx.lineCap="round",ctx.lineJoin="round",AVATAR_EDGES.forEach(([a,n])=>{if(!e.includes(a)||!e.includes(n))return;const o=p(t[a].xn),i=u(t[a].yn),s=p(t[n].xn),l=u(t[n].yn);ctx.strokeStyle="rgba(56,189,248,.35)",ctx.lineWidth=10,ctx.beginPath(),ctx.moveTo(o,i),ctx.lineTo(s,l),ctx.stroke(),ctx.strokeStyle="#d0f4ff",ctx.lineWidth=3.5,ctx.beginPath(),ctx.moveTo(o,i),ctx.lineTo(s,l),ctx.stroke()}),AVATAR_IDX.forEach(a=>{if(!e.includes(a))return;const n=p(t[a].xn),o=u(t[a].yn),i=0===a;ctx.shadowColor=i?"#e879f9":"#38bdf8",ctx.shadowBlur=i?16:10,ctx.fillStyle=i?"#e879f9":"#38bdf8",ctx.beginPath(),ctx.arc(n,o,i?9:5,0,2*Math.PI),ctx.fill()}),ctx.shadowBlur=0,ctx.restore()}function getSpeed(){return Math.min(.018,.006+.0018*Math.floor(distance/100))}function getSpeedLabel(){return`Speed ${Math.min(Math.floor(distance/100)+1,6)}`}function getSpawnInterval(){return Math.max(50,110-12*Math.floor(distance/100))}function handleHit(){if(hitOccurred)return;hitOccurred=!0,gameActive=!1;const t=laneCX(laneSmooth),e=GEO.botY;for(let a=0;a<50;a++)blastParticles.push(new BlastParticle(t,e));const a=document.getElementById("hitFlash");a.classList.remove("flash"),requestAnimationFrame(()=>a.classList.add("flash")),a.addEventListener("animationend",()=>a.classList.remove("flash"),{once:!0});const n=document.getElementById("youreOut");n.classList.add("show"),setTimeout(()=>n.classList.remove("show"),2e3),setTimeout(()=>{cancelAnimationFrame(animFrame),showGameOver()},2200)}function showGameOver(){const t=distance<50?0:distance<150?1:distance<300?2:distance<500?3:4;document.getElementById("finalScore").textContent=distance,document.getElementById("finalMsg").textContent=["üî• Caught by fire!","‚≠ê Nice try!","üéâ Good moves!","üèÜ Amazing runner!","üëë Unstoppable!"][t],document.getElementById("goEmoji").textContent=["üî•","‚≠ê","üéâ","üèÜ","üëë"][t],document.getElementById("gameover").classList.add("show")}function gameLoop(){animFrame=requestAnimationFrame(gameLoop),gameTimer++;const t=getSpeed();if(scrollOffset=(scrollOffset+.55*t)%1,ctx.fillStyle="#0a0a1a",ctx.fillRect(0,0,GEO.W,GEO.H),drawTrack(),lavaParticles.forEach(t=>{t.update(),t.draw(ctx)}),gameActive&&(laneSmooth+=.14*(targetLane-laneSmooth),isJumping&&(jumpOffset+=jumpVy,jumpVy+=8e-4*GEO.H,jumpOffset>=0&&(jumpOffset=0,jumpVy=0,isJumping=!1)),gameTimer%3==0&&(distance++,document.getElementById("distVal").textContent=distance,document.getElementById("speedBadge").textContent=getSpeedLabel()),gameTimer-lastObstacleFrame>getSpawnInterval()&&(obstacles.push(new Obstacle),lastObstacleFrame=gameTimer),obstacles=obstacles.filter(e=>{const a=e.update(t);if(!e.checked&&e.z>.86){e.checked=!0;const t=Math.round(laneSmooth);e.getCollisionLanes().includes(t)&&!isJumping&&handleHit()}return a})),obstacles.forEach(t=>t.draw(ctx)),blastParticles.forEach(t=>{t.update(),t.draw(ctx)}),blastParticles=blastParticles.filter(t=>t.alpha>0),drawAvatar(),!hitOccurred)for(let t=0;t<3;t++){const e=Math.abs(laneSmooth-t)<.55;ctx.beginPath(),ctx.arc(GEO.laneC[t],GEO.botY+24,e?7:4,0,2*Math.PI),ctx.fillStyle=e?"#FFD93D":"rgba(255,255,255,.22)",ctx.fill()}}function showCountdown(){return new Promise(t=>{const e=document.getElementById("countdown"),a=document.getElementById("countNum");e.classList.add("show");let n=3;a.textContent=n;const o=()=>{n--,n<=0?(a.textContent="GO! üèÉ",setTimeout(()=>{e.classList.remove("show"),t()},700)):(a.textContent=n,a.style.animation="none",requestAnimationFrame(()=>requestAnimationFrame(()=>a.style.animation="countPop .5s cubic-bezier(.34,1.56,.64,1)")),setTimeout(o,1e3))};a.style.animation="none",requestAnimationFrame(()=>requestAnimationFrame(()=>a.style.animation="countPop .5s cubic-bezier(.34,1.56,.64,1)")),setTimeout(o,1e3)})}async function setupCamera(){const t=document.getElementById("loadingMsg");try{t.textContent="Starting your webcam...";const e=await navigator.mediaDevices.getUserMedia({video:{width:1280,height:720,facingMode:"user"},audio:!1});video.srcObject=e,await new Promise(t=>{video.onloadedmetadata=t}),await video.play(),t.textContent="Loading body tracking AI... ü§ñ",pose=new Pose({locateFile:t=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${t}`}),pose.setOptions({modelComplexity:0,smoothLandmarks:!0,enableSegmentation:!1,minDetectionConfidence:.5,minTrackingConfidence:.5}),pose.onResults(onPoseResults),mpCamera=new Camera(video,{onFrame:async()=>{pose&&await pose.send({image:video})},width:1280,height:720}),await mpCamera.start(),resizeCanvas(),window.addEventListener("resize",resizeCanvas),t.textContent="Almost ready... üèÉ",await new Promise(t=>setTimeout(t,1800)),document.getElementById("loading").style.display="none",await showCountdown(),beginPlay()}catch(t){console.error(t),document.getElementById("loading").style.display="none",document.getElementById("permError").classList.add("show")}}function resizeCanvas(){canvas.width=window.innerWidth,canvas.height=window.innerHeight,computeGeo(),initLavaParticles()}function initLavaParticles(){lavaParticles=[];for(let t=0;t<60;t++)lavaParticles.push(new LavaParticle(t<30?"L":"R"))}function beginPlay(){distance=0,gameTimer=0,scrollOffset=0,obstacles=[],blastParticles=[],poseKeypoints=[],targetLane=1,laneSmooth=1,isJumping=!1,jumpOffset=0,jumpVy=0,hitOccurred=!1,lastObstacleFrame=0,document.getElementById("distVal").textContent="0",document.getElementById("speedBadge").textContent="Speed 1",document.getElementById("gameover").classList.remove("show"),gameActive=!0,gameLoop()}function restartGame(){document.getElementById("gameover").classList.remove("show"),cancelAnimationFrame(animFrame),beginPlay()}function goHome(){cancelAnimationFrame(animFrame),window.location.href="index.html"}function retryCamera(){document.getElementById("permError").classList.remove("show"),document.getElementById("loading").style.display="flex",setupCamera()}window.addEventListener("load",()=>{setupCamera()})</script></body></html>